<!DOCTYPE html>
<html lang="en">
<head>
    <title>Opensearch Machine</title>
    <link rel="stylesheet" href="https://caltechlibrary.github.io/css/site.css">
    <base href="./">
</head>
<body>
<header>
<a href="https://library.caltech.edu"><img src="https://caltechlibrary.github.io/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
	<li><a href="/">Home</a></li>
	<li><a href="./">README</a></li>
	<li><a href="user_manual.html">User Manual</a></li>
	<li><a href="LICENSE">LICENSE</a></li>
	<li><a href="INSTALL.html">INSTALL</a></li>
	<li><a href="about.html">About</a></li>
	<li><a href="search.html">Search</a></li>
	<li><a href="https://github.com/caltechlibrary/newt">GitHub</a></li>
</ul>
</nav>

<section>
<h1 id="part-i-opensearch-machine-vm">Part I: OpenSearch Machine
(VM)</h1>
<p>Exploring OpenSearch v2.5.0 using a Multipass managed virtual
machine</p>
<h1 id="knowledge-requirements">Knowledge requirements</h1>
<ul>
<li>You need to comfortable with working on the command line</li>
<li>General understanding of how the web works
<ul>
<li>HTTP, HTTP methods (e.g. GET, POST, PUT, DELETE)</li>
<li>JSON documents</li>
</ul></li>
</ul>
<h1 id="system-requirements-host-machine">System Requirements (Host
machine)</h1>
<ul>
<li>macOS, Linux or Windows based machine (ARM or Intel CPU)</li>
<li><a href="https://multipass.run">Multipass</a> needs to be
installed</li>
</ul>
<h1 id="software-requirements-virtual-machine">Software Requirements
(Virtual machine)</h1>
<ul>
<li><a href="https://curl.se">curl</a></li>
<li><a href="https://jqlang.github.io/jq/">jq</a></li>
<li>A plain text editor is nice</li>
</ul>
<h1 id="what-well-be-doing-host-and-virtual-machine">What we’ll be doing
(host and virtual machine)</h1>
<ul>
<li>Running programs “terminal” or Multipass “shell”</li>
<li>using a program called <code>curl</code> to interact with
OpenSearch</li>
<li>using <code>jq</code> to wrangle unruly JSON strings</li>
<li>light text editing, to script the longer commands</li>
</ul>
<h1 id="before-you-start">Before you start</h1>
<ol type="1">
<li>Make sure Multipass is installed and working</li>
<li>Know how to launch, start, stop, delete, purge your virtual
machine</li>
</ol>
<h1 id="getting-started">Getting started</h1>
<ol type="1">
<li>Run <code>./opensearch_machine.bash</code> to create the
<code>opensearch_machine</code> virtual machine</li>
<li>Run <code>multipass shell opensearch_machine</code> to finish
setting things up</li>
</ol>
<h1 id="on-the-opensearch-machine-vm">On, the
<code>opensearch-machine</code> VM</h1>
<ol type="1">
<li>Run <code>01-setup-scripts.bash</code></li>
<li>Run <code>07-add-opensearch.bash</code></li>
<li>Source the updated <code>.bashrc</code> file.</li>
<li>Reboot your virtual machine</li>
</ol>
<blockquote>
<p>Now we’re ready to start working with OpenSearch</p>
</blockquote>
<hr />
<h1 id="part-ii-working-with-opensearch">Part II: Working with
OpenSearch</h1>
<p>We’ll be using …</p>
<ul>
<li><a href="https://curl.se">curl</a> (aka curl)</li>
<li><a href="https://jqlang.github.io">jq</a></li>
<li>“<code>sudo systemctl</code>” to start/restart/status
OpenSearch</li>
</ul>
<h1 id="make-sure-opensearch-us-up-and-running-healthy">Make sure
OpenSearch us up and running healthy</h1>
<pre class="shell"><code>sudo systemctl status opensearch.service</code></pre>
<h1 id="exploring-opensearch">Exploring OpenSearch</h1>
<p>Check to see how OpenSearch is currently configured. By default
OpenSearch runs on HTTPS (self signed certs) and requires “admin”
account to access.</p>
<pre class="shell"><code>curl -k --user admin:admin \
  https://localhost:9200/_settings?pretty</code></pre>
<p>This should return JSON which shows the settings of our OpenSearch
installation.</p>
<h1 id="creating-our-first-index">Creating our first index</h1>
<ul>
<li>PUT, “{INDEX_NAME}”</li>
<li>“{INDEX_NAME}” = ‘contact-list’</li>
</ul>
<pre class="shell"><code>curl -k --user admin:admin \
  -X PUT https://localhost:9200/contact-list?pretty</code></pre>
<h1 id="response-from-creating-the-index">Response from creating the
index</h1>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;acknowledged&quot;</span> <span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;shards_acknowledged&quot;</span> <span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;index&quot;</span> <span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="creating-a-document-in-our-index">Creating a document in our
index</h1>
<ul>
<li>POST, “{INDEX_NAME}/_doc/{DOC_ID}”</li>
</ul>
<pre class="shell"><code>curl -k --user admin:admin \
  -H &#39;Content-Type: application/json&#39; \
  --data &#39;{&quot;name&quot;: &quot;Robert&quot;, &quot;email&quot;: &quot;rsdoiel@caltech.edu&quot;, &quot;orcid&quot;: &quot;0000-0003-0900-6903&quot;}&#39; \
  -X POST https://localhost:9200/contact-list/_doc/0000-0003-0900-6903?pretty</code></pre>
<h1 id="response-from-creating-our-document">Response from creating our
document</h1>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_index&quot;</span> <span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_id&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_version&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;result&quot;</span> <span class="fu">:</span> <span class="st">&quot;created&quot;</span><span class="fu">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_shards&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;total&quot;</span> <span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;successful&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;failed&quot;</span> <span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_seq_no&quot;</span> <span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_primary_term&quot;</span> <span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="reading-back-our-document">Reading back our document</h1>
<ul>
<li>GET, “{INDEX_NAME}/_doc/{DOC_ID}”</li>
</ul>
<pre class="shell"><code>curl -k --user admin:admin \
  https://localhost:9200/contact-list/_doc/0000-0003-0900-6903?pretty</code></pre>
<h1 id="read-document-response">Read document response</h1>
<div class="sourceCode" id="cb8"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_index&quot;</span> <span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_id&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_version&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_seq_no&quot;</span> <span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_primary_term&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;found&quot;</span> <span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_source&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span> <span class="fu">:</span> <span class="st">&quot;Robert&quot;</span><span class="fu">,</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;email&quot;</span> <span class="fu">:</span> <span class="st">&quot;rsdoiel@caltech.edu&quot;</span><span class="fu">,</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;orcid&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="searching-for-our-document">Searching for our document</h1>
<ul>
<li>GET, <code>{INDEX_NAME}/_search?q=robert</code></li>
</ul>
<pre class="shell"><code>curl -k --user admin:admin \
  https://localhost:9200/contact-list/_search?q=robert | \
  jq .</code></pre>
<p>NOTE: The “<code>?pretty</code>” option doesn’t work on
“<code>_search</code>” queries. But we have “<code>jq .</code>” to help
us out.</p>
<h1 id="search-results">Search results</h1>
<div class="sourceCode" id="cb10"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;took&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;timed_out&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_shards&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;total&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;successful&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;skipped&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;failed&quot;</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;hits&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;total&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;relation&quot;</span><span class="fu">:</span> <span class="st">&quot;eq&quot;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_score&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="er">.</span><span class="dv">2876821</span><span class="fu">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;hits&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;_index&quot;</span><span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;_id&quot;</span><span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;_score&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="er">.</span><span class="dv">2876821</span><span class="fu">,</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;_source&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Robert&quot;</span><span class="fu">,</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;rsdoiel@caltech.edu&quot;</span><span class="fu">,</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;orcid&quot;</span><span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="retrieving-an-indexs-contents">Retrieving an index’s
contents</h1>
<ul>
<li>GET, <code>{INDEX_NAME}/_search</code></li>
</ul>
<pre class="shell"><code>curl -k --user admin:admin -X GET https://localhost:9200/contact-list/_search?pretty</code></pre>
<p>NOTE: When you get lots of results (more than one “page”) you can
iterate over the pages. If you collect the ids you can then retrieve the
documents</p>
<h1 id="the-retrieved-indexs-response">The retrieved index’s
response</h1>
<div class="sourceCode" id="cb12"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;took&quot;</span> <span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;timed_out&quot;</span> <span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_shards&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;total&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;successful&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;skipped&quot;</span> <span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;failed&quot;</span> <span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;hits&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;total&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;value&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;relation&quot;</span> <span class="fu">:</span> <span class="st">&quot;eq&quot;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;max_score&quot;</span> <span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;hits&quot;</span> <span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;_index&quot;</span> <span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;_id&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;_score&quot;</span> <span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;_source&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;name&quot;</span> <span class="fu">:</span> <span class="st">&quot;Robert&quot;</span><span class="fu">,</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;email&quot;</span> <span class="fu">:</span> <span class="st">&quot;rsdoiel@caltech.edu&quot;</span><span class="fu">,</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;orcid&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="retrieving-the-specific-document-with-an-_id">Retrieving the
specific document with an <code>_id</code></h1>
<pre class="shell"><code>curl -k --user admin:admin \
  https://localhost:9200/contact-list/_doc/0000-0003-0900-6903?pretty</code></pre>
<p>And the response:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_index&quot;</span> <span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_id&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_version&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_seq_no&quot;</span> <span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_primary_term&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;found&quot;</span> <span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_source&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span> <span class="fu">:</span> <span class="st">&quot;Robert&quot;</span><span class="fu">,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;email&quot;</span> <span class="fu">:</span> <span class="st">&quot;rsdoiel@caltech.edu&quot;</span><span class="fu">,</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;orcid&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="updating-an-index-document">Updating an index document</h1>
<ul>
<li>POST, <code>{INDEX_NAME}/_doc/{DOC_ID}</code></li>
</ul>
<p>In update, I will add a website field.</p>
<pre class="shell"><code>curl -k --user admin:admin \
  -H &#39;Content-Type: application/json&#39; \
  --data &#39;{&quot;name&quot;:&quot;Robert&quot;,&quot;email&quot;:&quot;rsdoiel@caltech.edu&quot;,&quot;orcid&quot;:&quot;0000-0003-0900-6903&quot;,&quot;url&quot;:&quot;https://rsdoiel.github.io&quot;}&#39; \
  -X POST https://localhost:9200/contact-list/_doc/0000-0003-0900-6903?pretty</code></pre>
<h1 id="update-response">Update response</h1>
<div class="sourceCode" id="cb16"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_index&quot;</span> <span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_id&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_version&quot;</span> <span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;result&quot;</span> <span class="fu">:</span> <span class="st">&quot;updated&quot;</span><span class="fu">,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_shards&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;total&quot;</span> <span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;successful&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;failed&quot;</span> <span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_seq_no&quot;</span> <span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_primary_term&quot;</span> <span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="dropping-document">Dropping document</h1>
<ul>
<li>DELETE, <code>{INDEX_NAME}/_doc/{DOC_ID}</code></li>
</ul>
<pre class="shell"><code>curl -k --user admin:admin \
  -X DELETE https://localhost:9200/contact-list/_doc/0000-0003-0900-6903?pretty</code></pre>
<h1 id="dropping-document-response">Dropping document response</h1>
<div class="sourceCode" id="cb18"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_index&quot;</span> <span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_id&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_version&quot;</span> <span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;result&quot;</span> <span class="fu">:</span> <span class="st">&quot;deleted&quot;</span><span class="fu">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_shards&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;total&quot;</span> <span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;successful&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;failed&quot;</span> <span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_seq_no&quot;</span> <span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_primary_term&quot;</span> <span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="adding-back-our-deleted-document">Adding back our deleted
document</h1>
<pre class="shell"><code>curl -k --user admin:admin \
  -H &#39;Content-Type: application/json&#39; \
  --data &#39;{&quot;name&quot;: &quot;Robert&quot;, &quot;email&quot;: &quot;rsdoiel@caltech.edu&quot;, &quot;orcid&quot;: &quot;0000-0003-0900-6903&quot;}&#39; \
  -X POST https://localhost:9200/contact-list/_doc/0000-0003-0900-6903?pretty</code></pre>
<h1 id="response-from-adding-back-our-document">Response from adding
back our document</h1>
<div class="sourceCode" id="cb20"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_index&quot;</span> <span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_id&quot;</span> <span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_version&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;result&quot;</span> <span class="fu">:</span> <span class="st">&quot;created&quot;</span><span class="fu">,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_shards&quot;</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;total&quot;</span> <span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;successful&quot;</span> <span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;failed&quot;</span> <span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_seq_no&quot;</span> <span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_primary_term&quot;</span> <span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>NOTE: We can actually do an “add” with a POST, the
“<code>_version</code>” is set back to “1”.</p>
<h1 id="dumping-our-index-with-elasticdump">Dumping our index with
elasticdump</h1>
<p><a
href="https://inveniordm.docs.cern.ch/develop/howtos/backup_search_indices/#elasticdump"
class="uri">https://inveniordm.docs.cern.ch/develop/howtos/backup_search_indices/#elasticdump</a></p>
<p>Dumping our index data:</p>
<pre class="shell"><code>env NODE_TLS_REJECT_UNAUTHORIZED=0 elasticdump \
   --input https://admin:admin@localhost:9200/contact-list \
   --output contact-list.data.json \
   --type data</code></pre>
<p>If we had created an “index map” we’d want to dump that too.</p>
<p>For index mappings:</p>
<pre class="shell"><code>env NODE_TLS_REJECT_UNAUTHORIZED=0 elasticdump \
   --input https://admin:admin@localhost:9200/contact-list \
   --output contact-list.mappings.json \
   --type mapping</code></pre>
<h1 id="heres-what-our-data-dump-looks-like">Here’s what our data dump
looks like</h1>
<div class="sourceCode" id="cb23"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="er">jq</span> <span class="er">.</span> <span class="er">contact-list-data.json</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_index&quot;</span><span class="fu">:</span> <span class="st">&quot;contact-list&quot;</span><span class="fu">,</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_id&quot;</span><span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span><span class="fu">,</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_score&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;_source&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Robert&quot;</span><span class="fu">,</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;rsdoiel@caltech.edu&quot;</span><span class="fu">,</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;orcid&quot;</span><span class="fu">:</span> <span class="st">&quot;0000-0003-0900-6903&quot;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h1 id="dropping-an-index">Dropping an index</h1>
<ul>
<li>DELETE, <code>{INDEX_NAME}</code></li>
</ul>
<pre class="shell"><code>curl -k --user admin:admin \
  -X DELETE https://localhost:9200/contact-list</code></pre>
<p>The response should look like</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;acknowledged&quot;</span><span class="fu">:</span><span class="kw">true</span><span class="fu">}</span></span></code></pre></div>
<h1 id="restoring-an-index-with-elasticdump">Restoring an index with
elasticdump</h1>
<p>For index data:</p>
<pre class="shell"><code>env NODE_TLS_REJECT_UNAUTHORIZED=0 elasticdump \
   --input contact-list.data.json \
   --output https://admin:admin@localhost:9200/contact-list \
   --type data</code></pre>
<p>For index mapping:</p>
<pre class="shell"><code>env NODE_TLS_REJECT_UNAUTHORIZED=0 elasticdump \
   --input contact-list.mappings.json \
   --output https://admin:admin@localhost:9200/contact-list \
   --type mapping</code></pre>
<h1 id="what-weve-learned-so-far">What we’ve learned so far</h1>
<ul>
<li>Basic interactions of OpenSearch REST API</li>
<li>Basic management actions
<ul>
<li>create, read, search, update, delete</li>
</ul></li>
<li>Backup and restore with <code>elasticdump</code></li>
</ul>
<hr />
<h1 id="part-iii-future-topics-to-explore">Part: III: Future topics to
explore</h1>
<p>OpenSearch provides many additional features</p>
<ul>
<li>Improves search results using index mapping <a
href="https://opensearch.org/docs/latest/field-types/"
class="uri">https://opensearch.org/docs/latest/field-types/</a></li>
<li>Support analytics with aggregations <a
href="https://opensearch.org/docs/latest/aggregations/"
class="uri">https://opensearch.org/docs/latest/aggregations/</a></li>
</ul>
<p>Both are used heavily in Invenio RDM</p>
<h1 id="future-topics-to-explore-continued">Future topics to explore
(continued)</h1>
<p>OpenSearch provides many additional features</p>
<ul>
<li>Process data sets with ingest pipelines <a
href="https://opensearch.org/docs/latest/ingest-pipelines/"
class="uri">https://opensearch.org/docs/latest/ingest-pipelines/</a></li>
<li>Improve results with text analysis <a
href="https://opensearch.org/docs/latest/analyzers/"
class="uri">https://opensearch.org/docs/latest/analyzers/</a></li>
<li>GIS visualization <a
href="https://opensearch.org/docs/latest/dashboards/visualize/maps/"
class="uri">https://opensearch.org/docs/latest/dashboards/visualize/maps/</a></li>
<li>ML support <a
href="https://opensearch.org/docs/latest/ml-commons-plugin/"
class="uri">https://opensearch.org/docs/latest/ml-commons-plugin/</a></li>
</ul>
<h1 id="tooling-for-opensearch">Tooling for OpenSearch</h1>
<ul>
<li>JSON REST API running on port 9200</li>
<li>OpenSearch Dashboard</li>
<li>3rd party tooling
<ul>
<li>elasticdump (NodeJS/NPM)</li>
<li>curator (Python)</li>
<li>curl</li>
</ul></li>
</ul>
<h1 id="interesting-api-end-points">Interesting API end points</h1>
<ul>
<li><code>_settings</code></li>
<li><code>_aliases</code></li>
<li><code>_search</code></li>
<li><code>_mapping</code></li>
<li><code>_source</code></li>
<li><code>_doc</code></li>
</ul>
<hr />
<h1 id="concluding">Concluding</h1>
<ul>
<li>Thank you!</li>
</ul>
<h1 id="about">About</h1>
<ul>
<li>Caltech Library Digital Library Development Group</li>
<li><a href="https://caltechlibrary.github.io/opensearch-machine"
class="uri">https://caltechlibrary.github.io/opensearch-machine</a></li>
<li><a href="https://github.com/caltechlibrary/opensearch-machine"
class="uri">https://github.com/caltechlibrary/opensearch-machine</a></li>
<li>Issues <a
href="https://github.com/caltechlibrary/opensearch-machine/issues"
class="uri">https://github.com/caltechlibrary/opensearch-machine/issues</a></li>
</ul>
</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2023-2024 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>
